CREATE DATABASE IF NOT EXISTS finalProject;
USE finalProject;

CREATE TABLE IF NOT EXISTS user(
	userId VARCHAR(15) PRIMARY KEY,
	userName VARCHAR(45) NOT NULL UNIQUE,
	password VARCHAR(20) NOT NULL,
	email VARCHAR(45) NOT NULL UNIQUE,
	role VARCHAR(30) NOT NULL  
);

CREATE TABLE IF NOT EXISTS customer(
	cId VARCHAR(15) PRIMARY KEY,
	name VARCHAR(50) NOT NULL,
	address TEXT NOT NULL,
	contact VARCHAR(15),
	email VARCHAR(50)
);

CREATE TABLE IF NOT EXISTS room(
	rId VARCHAR(15)	PRIMARY KEY,
	type VARCHAR(45) NOT NULL,
	acNonAc VARCHAR(20) NOT NULL,
	price DECIMAL(10,2)
);

CREATE TABLE IF NOT EXISTS package(
	pkgId VARCHAR(15) PRIMARY KEY,
	pkgName VARCHAR(50) NOT NULL,
	price DECIMAL(10,2),
	include TEXT
);

CREATE TABLE IF NOT EXISTS orders(
	orderId VARCHAR(15) PRIMARY KEY,
	date DATE,
	stayDayCount INT NOT NULL,
	rId VARCHAR(15),
	pkgId VARCHAR(15),
	CONSTRAINT FOREIGN KEY(rId) REFERENCES room(rId) ON DELETE CASCADE ON UPDATE CASCADE,
	CONSTRAINT FOREIGN KEY(pkgId) REFERENCES package(pkgId) ON DELETE CASCADE ON UPDATE CASCADE
);

CREATE TABLE IF NOT EXISTS orderDetail(
	cId VARCHAR(15),
	orderId VARCHAR(15),
	CONSTRAINT FOREIGN KEY(cId) REFERENCES customer(cId) ON DELETE CASCADE ON UPDATE CASCADE,
	CONSTRAINT FOREIGN KEY(orderId) REFERENCES orders(orderId) ON DELETE CASCADE ON UPDATE CASCADE
);

CREATE TABLE IF NOT EXISTS paymentDetail(
	orderId VARCHAR(15),
	pId VARCHAR(15),
	date DATE,
	recevedAmount DECIMAL(10,2),
	balance DECIMAL(10,2),
	CONSTRAINT PRIMARY KEY(pId),
	CONSTRAINT FOREIGN KEY(orderId) REFERENCES orders(orderId) ON DELETE CASCADE ON UPDATE CASCADE
);

CREATE TABLE IF NOT EXISTS rentBike(
	regNo VARCHAR(15) PRIMARY KEY,
	model VARCHAR(45) NOT NULL,
	conditions VARCHAR(50) NOT NULL,
	pricePerDay DECIMAL(10,2)
);

CREATE TABLE IF NOT EXISTS rentBikeDetail(
	regNo VARCHAR(15),
	cId VARCHAR(15),
	CONSTRAINT FOREIGN KEY(regNo) REFERENCES rentBike(regNo) ON DELETE CASCADE ON UPDATE CASCADE,
	CONSTRAINT FOREIGN KEY(cId) REFERENCES customer(cId) ON DELETE CASCADE ON UPDATE CASCADE
);

CREATE TABLE IF NOT EXISTS meal(
	mId VARCHAR(15) PRIMARY KEY,
	name VARCHAR(45) NOT NULL,
	availableTime VARCHAR(45) NOT NULL,
	price DECIMAL(10,2)
);

CREATE TABLE IF NOT EXISTS activities(
	name VARCHAR(45) NOT NULL,
	price DECIMAL(10,2),
	description VARCHAR(50)
);

CREATE TABLE IF NOT EXISTS employee(
	eId VARCHAR(15) PRIMARY KEY,
	name VARCHAR(45) NOT NULL,
	address TEXT,
	contact VARCHAR(15) NOT NULL,
	nic VARCHAR(40) NOT NULL
);

CREATE TABLE IF NOT EXISTS roomOrderDetail(
	rId VARCHAR(15),
	cId VARCHAR(15),
	dste DATE,
	dayCount INT,
	CONSTRAINT FOREIGN KEY(cId) REFERENCES customer(cId) ON DELETE CASCADE ON UPDATE CASCADE,
	CONSTRAINT FOREIGN KEY(rId) REFERENCES room(rId) ON DELETE CASCADE ON UPDATE CASCADE
);

INSERT INTO user VALUES ('U002','ravindu','1234','ravinduk56@gmail.com','admin');
INSERT INTO customer VALUES ('C001','ravindu','galle','0765320187','ravinduk56@gmail.com');
INSERT INTO customer VALUES ('C002','kaushalya','mathara','0788730420','ravinduk58@gmail.com');

INSERT INTO room VALUES ('R001','single','Ac',1500,'yes');

INSERT INTO package VALUES ('P001','full package',1500,'all');

ALTER TABLE orders ADD  rId VARCHAR(15), 
CONSTRAINT FOREIGN KEY(rId) REFERENCES room(rId) ON DELETE CASCADE ON UPDATE CASCADE;

ALTER TABLE orders ADD  regNo VARCHAR(15);
ALTER TABLE orders ADD  bikeDayCount int;

String orderId;
String date;
int roomDayCount;
String rId;
String pkgId;
String regNo;
int bikeDayCount;
Double total;
Double receverdAmount;
Double balance;

UPDATE room SET availability = 'no' WHERE rId = 'R001';

UPDATE rentbike SET availability = 'no' WHERE regNo = 'BBB-4532';

ALTER TABLE paymentdetail 
	ADD COLUMN total decimal(10,2);

ALTER TABLE roomorderdetail 
	DROP COLUMN orderId;

DELETE FROM orders where orderId = 'D06';

INSERT INTO orders VALUES ('D001','2022-12-3',2,'R001','P001','XY-678',2);

delete from user where userId = '12';

INSERT INTO user VALUES ('U002','raviya','123','ravinduk57@gmail.com','Reception');

